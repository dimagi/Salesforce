<apex:page showHeader="true" sidebar="true" controller="HQSyncController">
    <style type="text/css">
        .serversSelect {
            height: 21.2px;
            vertical-align: top;
        }
        .manualRunButton {
            vertical-align: top;
            margin: 0px 0px 0px 3px !important;
        }
        .lastSyncSpan {
            height: 21.2px;
            margin-left: 3px;
            vertical-align: -webkit-baseline-middle !important;
        }
    </style>

    <apex:form >
        <apex:tabPanel switchType="server" selectedTab="tabOne" id="accountTabPanel" tabClass="activeTab" inactiveTabClass="inactiveTab">

            <apex:tab label="Domain synchronization - phase one" name="tabOne" id="tabOne">
                <apex:pageBlock title="CommcareHq Job Run - Domain, Internal Properties, Deployment" id="phase1Block">
                    <apex:actionPoller action="{!fetchDomainInstances}" reRender="phase1Block" interval="10" />
                    <apex:outputPanel rendered="{!domainIsRunning}">
                        <apex:image url="/img/loading32.gif"/>
                        <apex:commandButton action="{!fetchDomainInstances}" value="Refresh Status" rendered="{!domainIsRunning}"/>
                        <br/><br/>This Job is running !
                        <br/><br/><br/>
                        <b>Job Submitted Date</b> :  <apex:outputField value="{!batchClassJob.CreatedDate}"/><br/>
                        <b>Batches Processed</b> : {!batchClassJob.JobItemsProcessed}/{!batchClassJob.TotalJobItems}
                        <br/><br/><br/>
                        For more information on this job, please go to setup -> Monitoring -> Apex Jobs
                        <br/>NOTE : Only 1 instance of this job can run at a time.
                    </apex:outputPanel>
                    <br/><br/>
                    <div>
                        <apex:selectList styleClass="serversSelect" id="phaseOneServer" value="{!phaseOneServer}" disabled="{!if(accountingIsRunning == true || domainIsRunning == true, true, false)}"
                                            multiselect="false" size="1">
                            <apex:actionSupport event="onchange" rerender="phase1Block"/>
                            <apex:selectOptions value="{!serverCodes}"/>
                        </apex:selectList>
                        <apex:commandButton styleClass="manualRunButton" action="{!runDomainsSynchronizationJob}" value="Run Job Now" disabled="{!if(accountingIsRunning == true || domainIsRunning == true, true, false)}"/>
                    </div>
                </apex:pageBlock>
            </apex:tab>

            <apex:tab label="Accounting synchronization- phase two" name="tabTwo" id="tabTwo">
                <apex:pageBlock id="phase2Block">
                    <apex:actionPoller action="{!fetchAccountingInstances}" reRender="phase2Block" interval="10" status="status"/>
                    <div>
                        <apex:selectList styleClass="serversSelect" id="phaseTwoServer" value="{!phaseTwoServer}" disabled="{!if(accountingIsRunning == true || domainIsRunning == true, true, false)}"
                                multiselect="false" size="1">
                            <apex:actionSupport event="onchange" rerender="phase2Block"/>
                            <apex:selectOptions value="{!serverCodes}"/>
                        </apex:selectList>
                        <apex:commandButton styleClass="manualRunButton" action="{!runAccountingJob}" disabled="{!if(accountingIsRunning == true || domainIsRunning == true, true, false)}" value="Run Job Now"/>
                        <apex:commandButton styleClass="manualRunButton" action="{!fetchAccountingInstances}" value="Refresh Status"/>
                        <span class="lastSyncSpan" >Last {!phaseTwoServer} accounting successful date {!serverSuccessfulDate}</span>
                    </div>

                    <div style="height:20px;">
                        <apex:actionStatus startText="Refreshing..." id="status"/>
                    </div>

                    <apex:pageBlockTable value="{!phase2Jobs}" var="job">
                        <apex:column headerValue="Object Name">
                            {!job.jobName}
                        </apex:column>
                        <apex:column headerValue="Running Status">
                            <apex:image url="/img/loading32.gif" height="10px" rendered="{!job.isRunning}"/>
                            <apex:outputPanel rendered="{!job.isRunning}">
                                {!job.jobItemsProcessed}/{!job.totalJobItems}
                            </apex:outputPanel>
                        </apex:column>
                    </apex:pageBlockTable>
                </apex:pageBlock>
            </apex:tab>

        </apex:tabPanel>
    </apex:form>
</apex:page>